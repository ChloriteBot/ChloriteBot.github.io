---
layout: post
title:  "NOTE 1 入门PyTorch"
subtitle: "我一无所知，我好痛苦"
date:   2021-01-02 13:11:25
tags: Code
color: 'rgb(48,90,86)'
cover: '/assets/210102.png'
---



网上搜NLP推荐入门书籍，发现大一上学期怎么学也学不会的《人群与网络》教材赫然在目。学不会也不能怪我，这本书涉及的东西我在数据结构、线性代数、微观经济学里都找到了对应章节。现在又变成NLP入门书了，这合理吗？这是大一的我能一下明白的吗？

总之，我突然发现当我入门的时候，没有人是合适的聊天人选。`当然这也是因为此时大家正在经历期末考试，而且我周围没有很多cs专业学生`。这就是网站的用处了。

哎，最后还是用它来写代码了。

总之，老师留给我的题目里需要NLP内容，而大家都在讲基于神经网络的NLP。先稍微了解一下神经网络好了！



---

我也不知道干什么了，先看看这些包在干什么吧。在我的电脑里找到了奇怪教程，名字叫`60分钟入门PyTorch`的，打开瞧瞧。由于切换中英文太麻烦, 出现了中英文(及相关标点符号)混用的现象. 哎!

# 1 事先工作

## 安装tensorflow (Failed)

第一步我就遇到问题了，好痛苦。我无法用`pip install tensorflow`，出现了error like this

```
ERROR: Could not find a version that satisfies the requirement tensorflow
```

通过CSDN，可能是32位和64位的问题。

所以我`python -v`，checked my Python version. `Python 3.9.1 (tags/v3.9.1:1e5d33e, Dec 7 2020, 17:08:21) [MSC v.1927 64 bit (AMD64)] on win32`。这不是好好的64bit吗！why！

俺又点开了另一个CSDN帖子。它说我没安装numpy，因为每一个TF都要对应一个numpy。okay，这就`pip install numpy`。kuso!又是same problem

```
ERROR: Could not find a version that satisfies the requirement numpy
ERROR: No matching distribution found for numpy
```

学计算机的怎么能死在配置环境这一步！我又点开一个帖子。它让我惊觉，官网上写的是：`TensorFlow is tested and supported on the following 64-bit systems: Python 3.5–3.8`。这句话有两个重点，`64-bit`和`3.5-3.8`。

那么我的version是什么来着？`v3.9.1`！哈哈，fk u！语文没学好真要命，阅读理解要点都抓不住，浪费半小时，实在可恶。

这是唯一一个我不需要百度的step了。

总之我又下载了[Python Release Python 3.8.3](https://www.python.org/downloads/release/python-383/)，cmd，启动。总之为了避免不必要的问题，右键左下角win的logo，选择admin模式的cmd。还按照官网的三行代码来呗，简单的几句话我怎么用了一晚上？

```python
# Requires the latest pip
pip install --upgrade pip

# Current stable release for CPU and GPU
pip install tensorflow
```

新的step，新的error。我不活了！可恶

```
ERROR: Could not install packages due to an EnvironmentError: [WinError 5] Access is denied: 
```

我也不知道怎么回事，反正再检查pip 20.3.3已经更新好了。那就接着install呗，same error again。

```
ERROR: Could not find a version that satisfies the requirement tensorflow
ERROR: No matching distribution found for tensorflow
```

seems like 3.8.3并不属于3.5-3.8。Fine，梅开二度。经过这次我就是成功的python卸载安装大师了。本five终于顺藤摸瓜摸到了它的中文文档，[在 Windows 环境中从源代码构建](https://www.tensorflow.org/install/source_windows)。这回我不能不行了。

![image.png](https://i.loli.net/2021/01/03/fyV6GO5CKkI2NTu.png)

OMG我终于成功了第一步！换了个VPN节点，真好，成功了

第二步是安装bazel。已经十二点半了我不想再知道什么是bazel了，总之[win环境下 Bazel 离线安装教程](https://cloud.tencent.com/developer/article/1335894)用这个好像可以成功的样子。我的网络很稳定所以直接就可以在线安装，不用费劲离线安装了。

途中会出现很多问题，让你输入y or n。![image.png](https://i.loli.net/2021/01/03/Hp3rwxfbnyeuIq9.png)拜托，你都写了`if you don't run, the installation will fail`，我敢不选Yes吗？

反正可算是成功装完了，意外地顺利，真好！![image.png](https://i.loli.net/2021/01/03/4re3YVX5wNmFf2l.png)

到这里我已经完全整不会了，我怎么也不能装上。重新开始算了。

## 使用anaconda安装tensorflow

我好痛苦。放弃了官网的安装方式，改用anaconda。首先去官网下载个anaconda。然后打开`Anaconda navigator`和`prompt`，在prompt的界面输入

```c++
conda create -n /*你自己的环境名*/ tensorflow
conda activate /*环境名*/
```

然后就有了一个环境并且在环境里面了。具体见[【教程】最新傻瓜式安装 TensorFlow](https://www.bilibili.com/video/BV1ja4y1t7Qj)。我是傻瓜。

之后在anaconda的图形化界面也就是navigator里点开你的环境，缺什么包就装什么包。

# 2 阅读文档

[什么是PyTorch？ · Pytorch 中文文档 (apachecn.org)](https://pytorch.apachecn.org/docs/1.4/blitz/tensor_tutorial.html)

就是这么一个文档，网上有.ipynb版本可以直接运行，我就不放具体链接了。

一开头出现了`张量`两个大字, 然后我就不知道. 

## 张量（tensor）

一般被定义成多维数组，目的是把向量、矩阵推向更高的维度。张量在Pytorch中，既是基本数据结构，也是自动求梯度的工具。

标量，向量，矩阵等都是张量。其中标量是0维张量，向量是1维张量，矩阵是2维张量。我们通常见到的灰度图像是2维张量，彩色图像是3维张量。由若干三维张量可以构成4维张量，若干4维张量可以构成5维张量，以此类推。

### 张量的属性

​      **data：**用于存放tensor，是数据本体。

​      **grad：**data的梯度值。

​      **grad_fn：**记录创建张量时所用的方法（**函数**——乘法：`grad_fn = <MulBackward0>,`加法：`grad_fn = <AddBackward0>`）,**用于反向传播的梯度计算之用**。grad_fn指向创建Tensor的函数，如果某一个Tensor是由用户创建的，则指向：**None**。

​      **requires_grad：**指示是否需要梯度，对于需要求导的tensor，其requires_grad属性必须为True，即：`requires = True.`自己定义的tensor的requires_grad属性默认为False，神经网络层中的权值w的tensor的requires_grad属性默认为True。

​      **is_ leaf :** 指示是否是叶子结点（张量），用户创建的结点称为叶子结点（张量），如X 与 W。is_leaf 为False，即：`is_leaf = Ture,`的时候，则不是叶子节点,，is_leaf为True的时候是叶子节点。叶子节点在经过反向传播之后梯度值能够得以保留，非叶子节点的梯度值则为：**None**。

​	 **dtype：**张量的数据类型，分成浮点(16, 32, 64)，整型(8-有无符号, 16, 32, 64)和布尔三大类，共9种数据类型. 其中32位浮点和64位整型最为常用。图像预处理结果默认：`torch.float32`, 图像标签默认：`torch.int64`. 

​     **shape :** 张量的形状。如（32,3,448,448）就是一个`32*3*448*448`的4维张量，相当于32张`448*448`的RGB图像. 

​     **device :** 张量所在设备，GPU 或CPU. 张量在GPU上才能用其加速。

具体用法就是直接`.`啦, 我逐渐理解一切.

```python
# 输入一个列表，数据类型是int64
a = [[1, 2, 3, 4], [1, 2, 3, 4], [1, 2, 3, 4], [1, 2, 3, 4]]
# 创建张量
t = torch.tensor(a)
# 输出张量和张量的数据类型
print(t, '\n', t.dtype)
```

结果自然是:

```python
tensor([[1, 2, 3, 4],
        [1, 2, 3, 4],
        [1, 2, 3, 4],
        [1, 2, 3, 4]]) 
 torch.int64
```

### `touch.zeros()`

`torch.zeros(*size, out=None, dtype=None, layout=torch.strided, device=None, requires_grad=False)`

当然，输出完了全是0. 

​    **size：**张量的形状，是一个整数序列，如(448,448)。

​    **out：**输出张量到out指向的地址

​    **[layout](https://pytorch.org/docs/stable/tensor_attributes.html#torch.torch.layout)：**张量在内存中的布局形式，目前支持 `torch.strided`（密集张量），并提供实验支持 `torch.sparse_coo`（稀疏COO张量），默认值：`torch.strided,`它也是最常用的布局形式。

### `touch.zeros_like()`

创建与输入张量形状相同的全0张量. 

```python
#代码
a = torch.tensor([1, 2, 3, 4])
t = torch.zeros_like(a)
print('a:', a)
print('t:', t)
#结果
a: tensor([1, 2, 3, 4])
t: tensor([0, 0, 0, 0])
```

`torch.empty` and `torch.empty_like()`, filled with 未初始化数据, 看起来像随机数. 

### `torch.full()`

`torch.full(size, fill_value, out=None, dtype=None, layout=torch.strided, device=None, requires_grad=False)` 也有配套的`torch.full_like()`.

 **full_value：**填充到张量的值，必须是个数。

```python
#code
a = torch.full((3, 3), 3.14)
print(a)
#result
tensor([[3.1400, 3.1400, 3.1400],
        [3.1400, 3.1400, 3.1400],
        [3.1400, 3.1400, 3.1400]])
```

